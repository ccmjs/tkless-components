"use strict";(()=>{const component={name:"pdf_viewer",ccm:"https://ccmjs.github.io/ccm/versions/ccm-27.4.2.min.js",config:{annotation_layer:["ccm.load","https://ccmjs.github.io/tkless-components/libs/pdfjs-2/PDFLinkService.min.js"],css:["ccm.load","https://ccmjs.github.io/tkless-components/pdf_viewer/resources/styles-v3.min.css","https://ccmjs.github.io/tkless-components/libs/bootstrap-5/css/bootstrap-icons.min.css",{url:"https://ccmjs.github.io/tkless-components/libs/bootstrap-5/css/bootstrap-fonts.min.css",context:"head"}],downloadable:true,force_target_blank:true,helper:["ccm.load","https://ccmjs.github.io/akless-components/modules/versions/helper-8.4.1.min.mjs"],html:["ccm.load","https://ccmjs.github.io/tkless-components/pdf_viewer/resources/templates-v3.min.mjs"],images_path:"https://ccmjs.github.io/tkless-components/pdf_viewer/resources/images/",page:1,pdf:"https://ccmjs.github.io/tkless-components/pdf_viewer/resources/demo/de/slides.pdf",pdfjs:{lib:["ccm.load","https://ccmjs.github.io/tkless-components/libs/pdfjs-2/pdf.min.js"],worker:["ccm.load","https://ccmjs.github.io/tkless-components/libs/pdfjs-2/pdf.worker.min.js"],namespace:"pdfjs-dist/build/pdf"},text:["ccm.load","https://ccmjs.github.io/tkless-components/pdf_viewer/resources/resources-v3.min.mjs#de"],text_layer:true},Instance:function(){let $;let file;let page_nr;let last_event;let rendering=false;let pending=false;this.init=async()=>{$=Object.assign({},this.ccm.helper,this.helper);$.use(this.ccm);window[this.pdfjs.namespace].GlobalWorkerOptions.workerSrc=this.pdfjs.worker;this.pdfjs=pdfjsLib};this.ready=async()=>{this.routing&&this.routing.define({page:number=>{page_nr=number;renderPage()}});this.element.addEventListener("keydown",(event=>{switch(event.key){case"ArrowLeft":this.events.onPrev();break;case"ArrowRight":this.events.onNext();break;case"ArrowUp":this.events.onFirst();break;case"ArrowDown":this.events.onLast();break}}));$.touchControl(this.element,{onLeft:this.events.onPrev,onRight:this.events.onNext});this.dark==="auto"&&this.element.classList.add("dark_auto");this.dark===true&&this.element.classList.add("dark_mode");this.onready&&await this.onready({instance:this})};this.start=async()=>{try{file=await this.pdfjs.getDocument(this.pdf).promise}catch(exception){if(exception.name!=="PasswordException")return $.setContent(this.element,"");try{file=await this.pdfjs.getDocument({url:this.pdf,password:prompt(this.text.protected)}).promise}catch(e){}if(!file)return $.setContent(this.element,this.text.denied)}if(this.annotation_layer&&file){this.linkService=new this.annotation_layer;this.linkService.setDocument(file,null);this.linkService.setCcmInstance(this)}render();this.lang&&!this.lang.getContext()&&$.append(this.element.querySelector("header"),this.lang.root);!this.downloadable&&this.element.querySelector("canvas").addEventListener("contextmenu",(event=>event.preventDefault()));this.onstart&&await this.onstart({instance:this});if(!this.page)return;page_nr=this.page;if(this.routing&&this.routing.get())await this.routing.refresh();else renderPage()};this.events={onFirst:()=>{if(page_nr<=1)return;if(this.onchange&&this.onchange({name:last_event="first",page:page_nr,instance:this,before:true}))return;this.goTo(page_nr=1)},onPrev:()=>{if(page_nr<=1)return;if(this.onchange&&this.onchange({name:last_event="prev",page:page_nr,instance:this,before:true}))return;this.goTo(--page_nr)},onJump:event=>{const page=parseInt(event.target.value);event.target.value="";if(this.onchange&&this.onchange({name:last_event="jump",page:page,instance:this,before:true}))return;if(!page||page<1||page>file.numPages||page===page_nr)return;this.goTo(page)},onNext:()=>{if(page_nr>=file.numPages)return;if(this.onchange&&this.onchange({name:last_event="next",page:page_nr,instance:this,before:true}))return;this.goTo(++page_nr)},onLast:()=>{if(page_nr>=file.numPages)return;if(this.onchange&&this.onchange({name:last_event="last",page:page_nr,instance:this,before:true}))return;this.goTo(page_nr=file.numPages)},onDownload:()=>this.onchange&&this.onchange({name:"download",instance:this})};this.goTo=page=>{if(page<1||page>file.numPages)return;page_nr=page;this.routing&&this.routing.set("page-"+page_nr);renderPage()};this.getPage=()=>page_nr;this.getPages=()=>file.numPages;this.onbreakpoint=this.refresh=()=>renderPage();const render=(template="main")=>{this.html.render(this.html[template](this,page_nr,file.numPages),template==="controls"?this.element.querySelector("#controls"):this.element);this.lang&&this.lang.translate()};const renderPage=()=>{const page_elem=this.element.querySelector("#page");if(!page_elem)return;if(getComputedStyle(this.element).display!=="flex")return setTimeout(renderPage,100);if(rendering)return pending=true;rendering=true;const desiredWidth=page_elem.clientWidth;file.getPage(page_nr).then((page=>{render("controls");const viewport=page.getViewport({scale:1});const scale=desiredWidth/viewport.width;const scaledViewport=page.getViewport({scale:scale});const outputScale=window.devicePixelRatio||1;const canvas=this.element.querySelector("canvas");const context=canvas.getContext("2d");canvas.width=Math.floor(scaledViewport.width*outputScale);canvas.height=Math.floor(scaledViewport.height*outputScale);canvas.style.width=Math.floor(scaledViewport.width)+"px";canvas.style.height=canvas.parentElement.style.height=Math.floor(scaledViewport.height)+"px";const transform=outputScale!==1?[outputScale,0,0,outputScale,0,0]:null;const renderContext={canvasContext:context,transform:transform,viewport:scaledViewport};page.render(renderContext).promise.then((async()=>{if(this.text_layer){const text_layer=this.element.querySelector("#text-layer");text_layer.innerHTML="";text_layer.style.width=canvas.clientWidth+"px";text_layer.style.height=canvas.clientHeight+"px";this.pdfjs.renderTextLayer({textContent:await page.getTextContent(),container:text_layer,viewport:scaledViewport})}this.annotation_layer&&page.getAnnotations().then((annotationData=>{const annotation_layer=this.element.querySelector("#annotation-layer");annotation_layer.innerHTML="";annotation_layer.style.width=canvas.clientWidth+"px";annotation_layer.style.height=canvas.clientHeight+"px";this.pdfjs.AnnotationLayer.render({viewport:scaledViewport,div:annotation_layer,annotations:annotationData,page:page,linkService:this.linkService,imageResourcesPath:this.images_path})}));rendering=false;if(pending){pending=false;renderPage()}else this.onchange&&this.onchange({name:"goto",page:page_nr,instance:this})}))}))}}};let b="ccm."+component.name+(component.version?"-"+component.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[b])return window.ccm.files[b]=component;(b=window.ccm&&window.ccm.components[component.name])&&b.ccm&&(component.ccm=b.ccm);"string"===typeof component.ccm&&(component.ccm={url:component.ccm});let c=(component.ccm.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||[""])[0];if(window.ccm&&window.ccm[c])window.ccm[c].component(component);else{var a=document.createElement("script");document.head.appendChild(a);component.ccm.integrity&&a.setAttribute("integrity",component.ccm.integrity);component.ccm.crossorigin&&a.setAttribute("crossorigin",component.ccm.crossorigin);a.onload=function(){(c="latest"?window.ccm:window.ccm[c]).component(component);document.head.removeChild(a)};a.src=component.ccm.url}})();
//# sourceMappingURL=ccm.pdf_viewer.min.js.map